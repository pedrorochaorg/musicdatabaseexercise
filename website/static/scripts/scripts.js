"use strict";var apiUrl="/api";angular.module("MusicDatabaseApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/musics.html",controller:"MusicsCtrl",controllerAs:"musics",name:"Musics"}).when("/users",{templateUrl:"views/users.html",controller:"UsersCtrl",controllerAs:"users",name:"Users"}).otherwise({redirectTo:"/"})}]),angular.module("MusicDatabaseApp").controller("UsersCtrl",["APIData","$scope","$anchorScroll","$timeout",function(a,b,c,d){function e(){b.formMessages={error:!1,success:!1}}function f(){a.getUsers().then(function(a){b.users=a,b.preloaders.list=!1,b.preloaders.form=!1},function(a){console.log(a)})}function g(){a.getMusics().then(function(a){b.musics=a,a.length>0&&(b.selectedSong=b.musics[0].pk)},function(a){console.log(a)})}b.preloaders={list:!0,form:!1},b.formMessages={error:!1,success:!1},b.users=[],b.user={pk:null,username:"",email:"",musics:[]},b.musics=[],b.userToDelete=null,b.selectedMusic={album:null,track:null,artist:null},b.selectedSong=null,b.submitForm=function(c,g){g?(b.formMessages.error="Fill in all required(*) form fields!",d(e,5e3)):(b.preloaders.list=!1,b.preloaders.form=!0,null==c.pk||void 0==c.pk||-1==c.pk?a.createUser({username:c.username,email:c.email,musics:c.musics}).then(function(a){b.userForm.$setPristine(),b.preloaders.list=!0,b.preloaders.form=!1,b.formMessages.success="Record created successfuly!",d(e,5e3),f(),b.resetForm()},function(a){b.preloaders.list=!1,b.preloaders.form=!1;var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,d(e,5e3),console.log(a)}):a.updateUser({username:c.username,email:c.email,pk:c.pk,musics:c.musics}).then(function(a){b.userForm.$setPristine(),b.preloaders.list=!0,b.preloaders.form=!1,b.formMessages.success="Record updated successfuly!",d(e,5e3),f(),b.resetForm()},function(a){b.preloaders.list=!1,b.preloaders.form=!1;var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,d(e,5e3),console.log(a)}))},b.editUser=function(d){c(),b.preloaders.list=!1,b.preloaders.form=!0,a.getUser(d.pk).then(function(a){b.user=a,b.preloaders.form=!1},function(a){console.log(a)})},b.deleteUser=function(c){b.preloaders.list=!0,b.preloaders.form=!1,a.deleteUser(c.pk).then(function(a){b.formMessages.success="Record deleted successfuly!",d(e,5e3),f(),b.resetForm()},function(a){var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,d(e,5e3)})},b.prepareUserDeletion=function(a){b.userToDelete=a},b.addSong=function(a){b.user.musics.push(parseInt(a))},b.deleteUserSong=function(a,c){var d=b.user.musics.indexOf(a);-1!=d&&b.user.musics.splice(d,1),console.log(b.user)},b.resetForm=function(a){void 0==a&&(a=!1),b.user.username="",b.user.email="",b.user.pk=-1,b.user.musics=[],a&&(b.formMessages.success=!1,b.formMessages.error=!1),b.selectedSong=b.musics[0].pk},f(),g()}]),angular.module("MusicDatabaseApp").service("APIData",["$http","$q",function(a,b){return{getMusics:function(){return a.get(apiUrl+"/musics/").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getMusic:function(c){return a.get(apiUrl+"/musics/"+c+"/").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},createMusic:function(c){return a.post(apiUrl+"/musics/",c).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},updateMusic:function(c){return a.put(apiUrl+"/musics/"+c.pk+"/",c).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},deleteMusic:function(c){return a["delete"](apiUrl+"/musics/"+c+"/").then(function(a){return 204===a.status?!0:b.reject(a.data)},function(a){return b.reject(a.data)})},getUsers:function(){return a.get(apiUrl+"/users/").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},getUser:function(c){return a.get(apiUrl+"/users/"+c+"/").then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},createUser:function(c){return a.post(apiUrl+"/users/",c).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},updateUser:function(c){return a.put(apiUrl+"/users/"+c.pk+"/",c).then(function(a){return"object"==typeof a.data?a.data:b.reject(a.data)},function(a){return b.reject(a.data)})},deleteUser:function(c){return a["delete"](apiUrl+"/users/"+c+"/").then(function(a){return 204===a.status?!0:b.reject(a.data)},function(a){return b.reject(a.data)})},populate:function(){return a.get(apiUrl+"/populate/").then(function(a){return"object"==typeof a.data?a.data.status:b.reject(a.data)},function(a){return b.reject(a.data)})}}}]),angular.module("MusicDatabaseApp").filter("MusicFilter",function(){return function(a,b){var c=[];if(b.length>0)for(var d=0;d<a.length;d++){var e=a[d];-1!=b.indexOf(e.pk)&&c.push(e)}return c}}),angular.module("MusicDatabaseApp").filter("MusicSelectionFilter",function(){return function(a,b){var c=[];if(b.length>0)for(var d=0;d<a.length;d++){var e=a[d];-1==b.indexOf(e.pk)&&c.push(e)}else c=a;return c}}),angular.module("MusicDatabaseApp").controller("MusicsCtrl",["APIData","$scope","$anchorScroll","$timeout",function(a,b,c,d){function e(){b.formMessages={error:!1,success:!1}}function f(){a.getMusics().then(function(a){b.musics=a,b.preloaders.list=!1,b.preloaders.form=!1},function(a){console.log(a)})}b.preloaders={list:!0,form:!1,populate:!1},b.formMessages={error:!1,success:!1},b.musics=[],b.music={pk:-1,album:"",track:"",artist:""},b.musicToDelete=null,b.submitForm=function(c,g){g?(b.formMessages.error="Fill in all required(*) form fields!",d(e,5e3)):(b.preloaders.list=!1,b.preloaders.form=!0,null==c.pk||void 0==c.pk||-1==c.pk?a.createMusic({album:c.album,track:c.track,artist:c.artist,track_id:0}).then(function(a){b.musicForm.$setPristine(),b.preloaders.list=!0,b.preloaders.form=!1,b.formMessages.success="Record created successfuly!",d(e,5e3),f(),b.resetForm()},function(a){b.preloaders.list=!1,b.preloaders.form=!1;var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,d(e,5e3),console.log(a)}):a.updateMusic({album:c.album,track:c.track,artist:c.artist,pk:c.pk}).then(function(a){b.userForm.$setPristine(),b.preloaders.list=!0,b.preloaders.form=!1,b.formMessages.success="Record updated successfuly!",d(e,5e3),f(),b.resetForm()},function(a){b.preloaders.list=!1,b.preloaders.form=!1;var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,d(e,5e3)}))},b.editMusic=function(d){c(),b.preloaders.list=!1,b.preloaders.form=!0,a.getMusic(d.pk).then(function(a){b.preloaders.form=!1,b.music=a},function(a){b.preloaders.form=!1,console.log(a)})},b.deleteMusic=function(c){b.preloaders.list=!0,b.preloaders.form=!1,a.deleteMusic(c.pk).then(function(a){b.formMessages.success="Record deleted successfuly!",d(e,5e3),f(),b.resetForm()},function(a){var c="";for(var f in a)c+=""+a[f]+" ";b.formMessages.error=c,b.preloaders.list=!1,d(e,5e3)})},b.prepareMusicDeletion=function(a){b.musicToDelete=a},b.populate=function(){b.preloaders.list=!0,b.preloaders.form=!1,b.preloaders.populate=!0,b.musics=[],a.populate().then(function(a){f(),b.preloaders.populate=!1},function(a){console.log(a)})},b.resetForm=function(a){void 0==a&&(a=!1),b.music.artist="",b.music.album="",b.music.pk=-1,b.music.track="",a&&(b.formMessages.success=!1,b.formMessages.error=!1)},f()}]),angular.module("MusicDatabaseApp").service("routeNavigation",["$route","$location",function(a,b){var c=[];return angular.forEach(a.routes,function(a,b){a.name&&c.push({path:b,name:a.name})}),{routes:c,activeRoute:function(a){return a.path===b.path()}}}]),angular.module("MusicDatabaseApp").directive("navigation",["routeNavigation",function(a){return{restrict:"E",replace:!0,templateUrl:"views/navigation.html",controller:["$scope",function(b){b.routes=a.routes,b.activeRoute=a.activeRoute}]}}]),angular.module("MusicDatabaseApp").run(["$templateCache",function(a){a.put("views/musics.html",'<div class="row"> <!-- List Container Init --> <div class="col-lg-8 col-md-7 col-sm-12 col-xs-12"> <div class="panel panel-default"> <div class="panel-heading">Musics <img src="/static/images/preloader.gif" class="preloader small pull-right" ng-show="preloaders.list"></div> <div class="panel-body"> <div class="table-responsive"> <!-- Data Table Init --> <table class="table"> <thead> <tr> <th>Artist</th> <th>Album</th> <th>Track</th> <th class="options">Options</th> </tr> </thead> <tbody> <tr data-ng-repeat="item in musics"> <td>{{ item.artist }}</td> <td>{{ item.album }}</td> <td>{{ item.track }}</td> <td> <!-- Actions Init --> <button type="button" class="btn btn-primary btn-xs" data-ng-click="editMusic(item)"><span class="glyphicon glyphicon-pencil"></span> Edit</button> <button type="button" class="btn btn-danger btn-xs" data-ng-click="prepareMusicDeletion(item)" data-toggle="modal" data-target="#myModalA"><span class="glyphicon glyphicon-trash"></span> Delete</button> <!-- Actions End --> </td> </tr> </tbody> </table> <!-- Data Table End --> </div> </div> </div> </div> <!-- List Container End --> <!-- Form/Population Containers Init --> <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12"> <!-- Form Init --> <div class="panel panel-default"> <div class="panel-heading">Music Details <img src="/static/images/preloader.gif" class="preloader small pull-right" ng-show="preloaders.form"></div> <div class="panel-body"> <!-- Alerts Init --> <div class="alert alert-success" role="alert" data-ng-show="formMessages.success"> {{ formMessages.success }} </div> <div class="alert alert-danger" role="alert" data-ng-show="formMessages.error"> {{ formMessages.error }} </div> <!-- Alerts End --> <!-- Form Fields Init --> <form name="musicForm" novalidate> <div class="form-group" data-ng-class="{ \'has-error\' : musicForm.artist.$invalid && (musicForm.artist.$touched && !musicForm.artist.$pristine) }"> <label for="artist">Artist<sup>*</sup></label> <input type="text" name="artist" class="form-control" id="artist" data-ng-model="music.artist" placeholder="Artist" required> <p data-ng-show="musicForm.artist.$invalid && (musicForm.artist.$touched && !musicForm.artist.$pristine)" class="help-block">Artist Name is required.</p> </div> <div class="form-group"> <label for="album">Album</label> <input type="text" name="album" class="form-control" id="album" data-ng-model="music.album" placeholder="Album"> </div> <div class="form-group" data-ng-class="{ \'has-error\' : musicForm.track.$invalid && (musicForm.track.$touched && !musicForm.track.$pristine) }"> <label for="track">Track<sup>*</sup></label> <input type="text" name="track" class="form-control" id="track" data-ng-model="music.track" placeholder="Track" required> <p data-ng-show="musicForm.track.$invalid && (musicForm.track.$touched && !musicForm.track.$pristine)" class="help-block">Track Title is required.</p> </div> <input type="hidden" name="pk" id="pk" data-ng-model="music.pk"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <button type="submit" data-ng-click="submitForm(music,musicForm.$invalid)" class="btn btn-primary">Save</button> <button type="button" data-ng-click="resetForm(true)" class="btn btn-danger">Cancel</button> </div> </div> </form> <!-- Form Fields End --> </div> </div> <!-- Form End --> <!-- Populate Action Init --> <div class="panel panel-default"> <div class="panel-heading">Populate <img src="/static/images/preloader.gif" class="preloader small pull-right" ng-show="preloaders.populate"></div> <div class="panel-body"> <div class="form-group"> <label for="populateBtn">Get Data From http://freemusicarchive.org</label><br> <button id="populateBtn" type="button" data-ng-click="populate()" class="btn btn-primary btn-lg">Execute</button> </div> </div> </div> <!-- Populate Action End --> </div> <!-- Form/Population Containers End --> </div> <!-- Delete Modal Init --> <div class="modal fade" id="myModalA" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="myModalLabel">Delete Music</h4> </div> <div class="modal-body"> <p>Do you really wish to delete this Music?</p> </div> <div class="modal-footer"> <button type="button" class="btn btn-danger" data-ng-click="deleteMusic(musicToDelete)" data-dismiss="modal">Delete</button> <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button> </div> </div> </div> </div> <!-- Delete Modal End -->'),a.put("views/navigation.html",'<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" ng-click="showMobileNav = !showMobileNav"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="#">Music Database</a> </div> <div class="collapse navbar-collapse" ng-class="{in: showMobileNav}"> <ul class="nav navbar-nav"> <li ng-repeat="route in routes" ng-class="{active: activeRoute(route)}"> <a href="#{{ route.path }}">{{ route.name }}</a> </li> </ul> </div> </nav>'),a.put("views/users.html",'<div class="row"> <!-- List Container Init --> <div class="col-lg-8 col-md-7 col-sm-12 col-xs-12"> <div class="panel panel-default"> <div class="panel-heading">Users <img src="/static/images/preloader.gif" class="preloader small pull-right" ng-show="preloaders.list"></div> <div class="panel-body align-center"> <div class="table-responsive"> <!-- Data Table Init --> <table class="table align-left"> <thead> <tr> <th>Username</th> <th>Email</th> <th>Musics</th> <th class="options">Options</th> </tr> </thead> <tbody> <tr data-ng-repeat="item in users"> <td>{{ item.username }}</td> <td>{{ item.email }}</td> <td> <ul> <li data-ng-repeat="it in musics | MusicFilter:item.musics"> {{ (it.artist + \' - \' + it.track + \'( \' + it.album + \' )\') }} </li> </ul> </td> <td> <!-- Actions Init --> <button type="button" class="btn btn-primary btn-xs" data-ng-click="editUser(item)"><span class="glyphicon glyphicon-pencil"></span> Edit</button> <button type="button" class="btn btn-danger btn-xs" data-ng-click="prepareUserDeletion(item)" data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-trash"></span> Delete</button> <!-- Actions End --> </td>  </tr></tbody> </table> <!-- Data Table End --> </div> </div> </div> </div> <!-- List Container End --> <!-- Form Containers Init --> <div class="col-lg-4 col-md-5 col-sm-12 col-xs-12"> <!-- Form Init --> <div class="panel panel-default"> <div class="panel-heading">User Details <img src="/static/images/preloader.gif" class="preloader small pull-right" ng-show="preloaders.form"></div> <div class="panel-body"> <!-- Alerts Init --> <div class="alert alert-success" role="alert" data-ng-show="formMessages.success"> {{ formMessages.success }} </div> <div class="alert alert-danger" role="alert" data-ng-show="formMessages.error"> {{ formMessages.error }} </div> <!-- Alerts End --> <!-- Form Fields Init --> <form name="userForm" novalidate> <div class="form-group" data-ng-class="{ \'has-error\' : userForm.username.$invalid && (userForm.username.$touched && !userForm.username.$pristine) }"> <label for="username">Username<sup>*</sup></label> <input type="text" name="username" class="form-control" id="username" data-ng-model="user.username" placeholder="Username" required> <p data-ng-show="userForm.username.$invalid && (userForm.username.$touched && !userForm.username.$pristine)" class="help-block">Username is required.</p> </div> <div class="form-group" data-ng-class="{ \'has-error\' : userForm.email.$invalid && (userForm.email.$touched && !userForm.email.$pristine)}"> <label for="email">Email<sup>*</sup></label> <input type="email" class="form-control" id="email" name="email" data-ng-model="user.email" placeholder="Email" required> <p ng-show="userForm.email.$invalid && (userForm.email.$touched && !userForm.email.$pristine)" class="help-block">Enter a valid email.</p> </div> <!-- Musics Init --> <div class="panel panel-default"> <div class="panel-heading">Musics</div> <div class="panel-body"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <div class="table-responsive"> <table class="table"> <thead> <tr> <th>Artist</th> <th>Album</th> <th>Track</th> <th>Options</th> </tr> </thead> <tbody> <tr data-ng-repeat="item in musics | MusicFilter:user.musics"> <td>{{ item.artist }}</td> <td>{{ item.album }}</td> <td>{{ item.track }}</td> <td> <button type="button" class="btn btn-danger btn-xs" data-ng-click="deleteUserSong(item.pk,user)"><span class="glyphicon glyphicon-trash"></span> Delete</button> </td> </tr> </tbody> </table> </div> </div> </div> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <h6> Add Song</h6> </div> <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10"> <select name="song" id="song" class="form-control" data-ng-model="selectedSong"> <option data-ng-repeat="item in musics | MusicSelectionFilter:user.musics" value="{{ item.pk }}" ng-selected="{{ item.pk == selecetdSong }}">{{ (item.artist + \' - \' + item.track + \'( \' + item.album + \' )\') }}</option> </select> </div> <div class="col-lg-2 col-md-2 col-sm-2 col-xs-2"> <button type="button" data-ng-click="addSong(selectedSong)" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span></button> </div> </div> </div> </div> <!-- Musics End --> <input type="hidden" name="pk" id="pk" data-ng-model="user.pk"> <input type="hidden" name="musics" id="musics" data-ng-model="user.musics"> <div class="row"> <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12"> <button type="submit" data-ng-click="submitForm(user,userForm.$invalid)" class="btn btn-primary">Save</button> <button type="button" data-ng-click="resetForm(true)" class="btn btn-danger">Cancel</button> </div> </div> </form> <!-- Form Fields End --> </div> </div> <!-- Form End --> </div> <!-- Form Containers End --> </div> <!-- Delete Modal Init --> <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="myModalLabel">Delete User</h4> </div> <div class="modal-body"> Do you really wish to delete this user? </div> <div class="modal-footer"> <button type="button" class="btn btn-danger" data-ng-click="deleteUser(userToDelete)" data-dismiss="modal">Delete</button> <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button> </div> </div> </div> </div> <!-- Delete Modal End -->')}]);